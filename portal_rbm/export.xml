<datapower-configuration version="3">
    <configuration domain="APICE1-Sandbox">
        <Matching name="URL_MatchAll_V1">
            <mAdminState>enabled</mAdminState>
            <MatchRules>
                <Type>url</Type>
                <HttpTag/>
                <HttpValue/>
                <Url>*</Url>
                <ErrorCode/>
                <XPATHExpression/>
                <Method>default</Method>
                <CustomMethod/>
            </MatchRules>
            <MatchWithPCRE>off</MatchWithPCRE>
            <CombineWithOr>off</CombineWithOr>
        </Matching>
        <StylePolicyAction name="ProcessTokenResponse_gatewayscript">
            <mAdminState>enabled</mAdminState>
            <Type>gatewayscript</Type>
            <Input>INPUT</Input>
            <ParseSettingsReference>
                <URL/>
                <Literal/>
                <Default/>
            </ParseSettingsReference>
            <ParseMetricsResultType>none</ParseMetricsResultType>
            <TransformLanguage>none</TransformLanguage>
            <GatewayScriptLocation>local:///authorize-user.js</GatewayScriptLocation>
            <ActionDebug persisted="false">off</ActionDebug>
            <Output>PIPE</Output>
            <NoTranscodeUtf8>off</NoTranscodeUtf8>
            <NamedInOutLocationType>default</NamedInOutLocationType>
            <SSLClientConfigType>proxy</SSLClientConfigType>
            <Transactional>off</Transactional>
            <SOAPValidation>body</SOAPValidation>
            <SQLSourceType>static</SQLSourceType>
            <JWSVerifyStripSignature>on</JWSVerifyStripSignature>
            <Asynchronous>off</Asynchronous>
            <ResultsMode>first-available</ResultsMode>
            <RetryCount>0</RetryCount>
            <RetryInterval>1000</RetryInterval>
            <MultipleOutputs>off</MultipleOutputs>
            <IteratorType>XPATH</IteratorType>
            <Timeout>0</Timeout>
            <MethodRewriteType>GET</MethodRewriteType>
            <MethodType>POST</MethodType>
            <MethodType2>POST</MethodType2>
        </StylePolicyAction>
        <StylePolicyAction name="PipeToOutput_results">
            <mAdminState>enabled</mAdminState>
            <Type>results</Type>
            <Input>PIPE</Input>
            <ParseSettingsReference>
                <URL/>
                <Literal/>
                <Default/>
            </ParseSettingsReference>
            <ParseMetricsResultType>none</ParseMetricsResultType>
            <TransformLanguage>none</TransformLanguage>
            <ActionDebug persisted="false">off</ActionDebug>
            <NoTranscodeUtf8>off</NoTranscodeUtf8>
            <NamedInOutLocationType>default</NamedInOutLocationType>
            <SSLClientConfigType>proxy</SSLClientConfigType>
            <OutputType>default</OutputType>
            <Transactional>off</Transactional>
            <SOAPValidation>body</SOAPValidation>
            <SQLSourceType>static</SQLSourceType>
            <JWSVerifyStripSignature>on</JWSVerifyStripSignature>
            <Asynchronous>off</Asynchronous>
            <ResultsMode>first-available</ResultsMode>
            <RetryCount>0</RetryCount>
            <RetryInterval>1000</RetryInterval>
            <MultipleOutputs>off</MultipleOutputs>
            <IteratorType>XPATH</IteratorType>
            <Timeout>0</Timeout>
            <MethodRewriteType>GET</MethodRewriteType>
            <MethodType>POST</MethodType>
            <MethodType2>POST</MethodType2>
        </StylePolicyAction>
        <StylePolicyRule name="TokenProxy_Policy_V1_ResponseRule">
            <mAdminState>enabled</mAdminState>
            <Actions class="StylePolicyAction">ProcessTokenResponse_gatewayscript</Actions>
            <Actions class="StylePolicyAction">PipeToOutput_results</Actions>
            <Direction>response-rule</Direction>
            <InputFormat>none</InputFormat>
            <OutputFormat>none</OutputFormat>
            <NonXMLProcessing>off</NonXMLProcessing>
            <Unprocessed>off</Unprocessed>
        </StylePolicyRule>
        <StylePolicy name="TokenProxy_Policy_V1">
            <mAdminState>enabled</mAdminState>
            <DefStylesheetForSoap>store:///filter-reject-all.xsl</DefStylesheetForSoap>
            <DefStylesheetForXsl>store:///identity.xsl</DefStylesheetForXsl>
            <DefXQueryForJSON>store:///reject-all-json.xq</DefXQueryForJSON>
            <PolicyMaps>
                <Match class="Matching">URL_MatchAll_V1</Match>
                <Rule class="StylePolicyRule">TokenProxy_Policy_V1_ResponseRule</Rule>
            </PolicyMaps>
        </StylePolicy>
        <CryptoKey name="Proxy_CryptoKey_V1">
            <mAdminState>enabled</mAdminState>
            <Filename>cert:///tokenproxy.pem.key</Filename>
            <PasswordAlias>off</PasswordAlias>
        </CryptoKey>
        <CryptoCertificate name="Proxy_CryptoCert_V1">
            <mAdminState>enabled</mAdminState>
            <Filename>cert:///tokenproxy.pem.cer</Filename>
            <PasswordAlias>off</PasswordAlias>
            <IgnoreExpiration>off</IgnoreExpiration>
        </CryptoCertificate>
        <CryptoIdentCred name="Proxy_IdCred_V1">
            <mAdminState>enabled</mAdminState>
            <Key class="CryptoKey">Proxy_CryptoKey_V1</Key>
            <Certificate class="CryptoCertificate">Proxy_CryptoCert_V1</Certificate>
        </CryptoIdentCred>
        <SSLServerProfile name="Proxy_ServerProfile_V1">
            <mAdminState>enabled</mAdminState>
            <Protocols>
                <SSLv3>off</SSLv3>
                <TLSv1d0>on</TLSv1d0>
                <TLSv1d1>on</TLSv1d1>
                <TLSv1d2>on</TLSv1d2>
            </Protocols>
            <Ciphers>ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_AES_256_GCM_SHA384</Ciphers>
            <Ciphers>ECDHE_ECDSA_WITH_AES_256_CBC_SHA384</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_AES_256_CBC_SHA384</Ciphers>
            <Ciphers>ECDHE_ECDSA_WITH_AES_256_CBC_SHA</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_AES_256_CBC_SHA</Ciphers>
            <Ciphers>DHE_DSS_WITH_AES_256_GCM_SHA384</Ciphers>
            <Ciphers>DHE_RSA_WITH_AES_256_GCM_SHA384</Ciphers>
            <Ciphers>DHE_RSA_WITH_AES_256_CBC_SHA256</Ciphers>
            <Ciphers>DHE_DSS_WITH_AES_256_CBC_SHA256</Ciphers>
            <Ciphers>DHE_RSA_WITH_AES_256_CBC_SHA</Ciphers>
            <Ciphers>DHE_DSS_WITH_AES_256_CBC_SHA</Ciphers>
            <Ciphers>RSA_WITH_AES_256_GCM_SHA384</Ciphers>
            <Ciphers>RSA_WITH_AES_256_CBC_SHA256</Ciphers>
            <Ciphers>RSA_WITH_AES_256_CBC_SHA</Ciphers>
            <Ciphers>ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_AES_128_GCM_SHA256</Ciphers>
            <Ciphers>ECDHE_ECDSA_WITH_AES_128_CBC_SHA256</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_AES_128_CBC_SHA256</Ciphers>
            <Ciphers>ECDHE_ECDSA_WITH_AES_128_CBC_SHA</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_AES_128_CBC_SHA</Ciphers>
            <Ciphers>DHE_DSS_WITH_AES_128_GCM_SHA256</Ciphers>
            <Ciphers>DHE_RSA_WITH_AES_128_GCM_SHA256</Ciphers>
            <Ciphers>DHE_RSA_WITH_AES_128_CBC_SHA256</Ciphers>
            <Ciphers>DHE_DSS_WITH_AES_128_CBC_SHA256</Ciphers>
            <Ciphers>DHE_RSA_WITH_AES_128_CBC_SHA</Ciphers>
            <Ciphers>DHE_DSS_WITH_AES_128_CBC_SHA</Ciphers>
            <Ciphers>RSA_WITH_AES_128_GCM_SHA256</Ciphers>
            <Ciphers>RSA_WITH_AES_128_CBC_SHA256</Ciphers>
            <Ciphers>RSA_WITH_AES_128_CBC_SHA</Ciphers>
            <Ciphers>ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_3DES_EDE_CBC_SHA</Ciphers>
            <Ciphers>DHE_RSA_WITH_3DES_EDE_CBC_SHA</Ciphers>
            <Ciphers>DHE_DSS_WITH_3DES_EDE_CBC_SHA</Ciphers>
            <Ciphers>RSA_WITH_3DES_EDE_CBC_SHA</Ciphers>
            <Idcred class="CryptoIdentCred">Proxy_IdCred_V1</Idcred>
            <RequestClientAuth>off</RequestClientAuth>
            <RequireClientAuth>off</RequireClientAuth>
            <ValidateClientCert>off</ValidateClientCert>
            <SendClientAuthCAList>on</SendClientAuthCAList>
            <Caching>on</Caching>
            <CacheTimeout>300</CacheTimeout>
            <CacheSize>20</CacheSize>
            <SSLOptions>
                <max-duration>off</max-duration>
                <max-renegotiation>off</max-renegotiation>
            </SSLOptions>
            <MaxSSLDuration>60</MaxSSLDuration>
            <NumberOfRenegotiationAllowed>0</NumberOfRenegotiationAllowed>
            <ProhibitResumeOnReneg>off</ProhibitResumeOnReneg>
            <Compression>off</Compression>
            <AllowLegacyRenegotiation>off</AllowLegacyRenegotiation>
            <PreferServerCiphers>on</PreferServerCiphers>
            <EllipticCurves>secp521r1</EllipticCurves>
            <EllipticCurves>secp384r1</EllipticCurves>
            <EllipticCurves>secp256k1</EllipticCurves>
            <EllipticCurves>secp256r1</EllipticCurves>
        </SSLServerProfile>
        <SSLClientProfile name="Proxy_ClientProfile_V1">
            <mAdminState>enabled</mAdminState>
            <Protocols>
                <SSLv3>off</SSLv3>
                <TLSv1d0>on</TLSv1d0>
                <TLSv1d1>on</TLSv1d1>
                <TLSv1d2>on</TLSv1d2>
            </Protocols>
            <Ciphers>ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_AES_256_GCM_SHA384</Ciphers>
            <Ciphers>ECDHE_ECDSA_WITH_AES_256_CBC_SHA384</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_AES_256_CBC_SHA384</Ciphers>
            <Ciphers>ECDHE_ECDSA_WITH_AES_256_CBC_SHA</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_AES_256_CBC_SHA</Ciphers>
            <Ciphers>DHE_DSS_WITH_AES_256_GCM_SHA384</Ciphers>
            <Ciphers>DHE_RSA_WITH_AES_256_GCM_SHA384</Ciphers>
            <Ciphers>DHE_RSA_WITH_AES_256_CBC_SHA256</Ciphers>
            <Ciphers>DHE_DSS_WITH_AES_256_CBC_SHA256</Ciphers>
            <Ciphers>DHE_RSA_WITH_AES_256_CBC_SHA</Ciphers>
            <Ciphers>DHE_DSS_WITH_AES_256_CBC_SHA</Ciphers>
            <Ciphers>RSA_WITH_AES_256_GCM_SHA384</Ciphers>
            <Ciphers>RSA_WITH_AES_256_CBC_SHA256</Ciphers>
            <Ciphers>RSA_WITH_AES_256_CBC_SHA</Ciphers>
            <Ciphers>ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_AES_128_GCM_SHA256</Ciphers>
            <Ciphers>ECDHE_ECDSA_WITH_AES_128_CBC_SHA256</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_AES_128_CBC_SHA256</Ciphers>
            <Ciphers>ECDHE_ECDSA_WITH_AES_128_CBC_SHA</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_AES_128_CBC_SHA</Ciphers>
            <Ciphers>DHE_DSS_WITH_AES_128_GCM_SHA256</Ciphers>
            <Ciphers>DHE_RSA_WITH_AES_128_GCM_SHA256</Ciphers>
            <Ciphers>DHE_RSA_WITH_AES_128_CBC_SHA256</Ciphers>
            <Ciphers>DHE_DSS_WITH_AES_128_CBC_SHA256</Ciphers>
            <Ciphers>DHE_RSA_WITH_AES_128_CBC_SHA</Ciphers>
            <Ciphers>DHE_DSS_WITH_AES_128_CBC_SHA</Ciphers>
            <Ciphers>RSA_WITH_AES_128_GCM_SHA256</Ciphers>
            <Ciphers>RSA_WITH_AES_128_CBC_SHA256</Ciphers>
            <Ciphers>RSA_WITH_AES_128_CBC_SHA</Ciphers>
            <Ciphers>ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA</Ciphers>
            <Ciphers>ECDHE_RSA_WITH_3DES_EDE_CBC_SHA</Ciphers>
            <Ciphers>DHE_RSA_WITH_3DES_EDE_CBC_SHA</Ciphers>
            <Ciphers>DHE_DSS_WITH_3DES_EDE_CBC_SHA</Ciphers>
            <Ciphers>RSA_WITH_3DES_EDE_CBC_SHA</Ciphers>
            <Idcred class="CryptoIdentCred">Proxy_IdCred_V1</Idcred>
            <ValidateServerCert>off</ValidateServerCert>
            <Caching>on</Caching>
            <CacheTimeout>300</CacheTimeout>
            <CacheSize>100</CacheSize>
            <SSLClientFeatures>
                <use-sni>on</use-sni>
                <permit-insecure-servers>off</permit-insecure-servers>
                <compression>off</compression>
            </SSLClientFeatures>
            <EllipticCurves>secp521r1</EllipticCurves>
            <EllipticCurves>secp384r1</EllipticCurves>
            <EllipticCurves>secp256k1</EllipticCurves>
            <EllipticCurves>secp256r1</EllipticCurves>
            <UseCustomSNIHostname>no</UseCustomSNIHostname>
            <ValidateHostname>off</ValidateHostname>
            <HostnameValidationFlags>
                <X509_CHECK_FLAG_ALWAYS_CHECK_SUBJECT>off</X509_CHECK_FLAG_ALWAYS_CHECK_SUBJECT>
                <X509_CHECK_FLAG_NO_WILDCARDS>off</X509_CHECK_FLAG_NO_WILDCARDS>
                <X509_CHECK_FLAG_NO_PARTIAL_WILDCARDS>off</X509_CHECK_FLAG_NO_PARTIAL_WILDCARDS>
                <X509_CHECK_FLAG_MULTI_LABEL_WILDCARDS>off</X509_CHECK_FLAG_MULTI_LABEL_WILDCARDS>
                <X509_CHECK_FLAG_SINGLE_LABEL_SUBDOMAINS>off</X509_CHECK_FLAG_SINGLE_LABEL_SUBDOMAINS>
            </HostnameValidationFlags>
            <HostnameValidationFailOnError>off</HostnameValidationFailOnError>
        </SSLClientProfile>
        <XMLFirewallService name="APICTokenProxy">
            <mAdminState>enabled</mAdminState>
            <LocalAddress>APICE1-MGMT</LocalAddress>
            <UserSummary>Proxy for OAuth 2.0 Token Requests</UserSummary>
            <Priority>normal</Priority>
            <LocalPort>10001</LocalPort>
            <RemoteAddress>oidc-provider.example.org</RemoteAddress>
            <RemotePort>443</RemotePort>
            <HTTPTimeout>120</HTTPTimeout>
            <HTTPPersistTimeout>180</HTTPPersistTimeout>
            <DoHostRewrite>on</DoHostRewrite>
            <SuppressHTTPWarnings>off</SuppressHTTPWarnings>
            <HTTPCompression>off</HTTPCompression>
            <HTTPIncludeResponseTypeEncoding>off</HTTPIncludeResponseTypeEncoding>
            <AlwaysShowErrors>off</AlwaysShowErrors>
            <DisallowGet>off</DisallowGet>
            <DisallowEmptyResponse>off</DisallowEmptyResponse>
            <HTTPPersistentConnections>on</HTTPPersistentConnections>
            <HTTPClientIPLabel>X-Client-IP</HTTPClientIPLabel>
            <HTTPLogCorIDLabel>X-Global-Transaction-ID</HTTPLogCorIDLabel>
            <HTTPProxyPort>800</HTTPProxyPort>
            <HTTPVersion>
                <Front>HTTP/1.1</Front>
                <Back>HTTP/1.1</Back>
            </HTTPVersion>
            <DoChunkedUpload>off</DoChunkedUpload>
            <DefaultParamNamespace>http://www.datapower.com/param/config</DefaultParamNamespace>
            <QueryParamNamespace>http://www.datapower.com/param/query</QueryParamNamespace>
            <ForcePolicyExec>off</ForcePolicyExec>
            <MonitorProcessingPolicy>terminate-at-first-throttle</MonitorProcessingPolicy>
            <DebugMode persisted="false">off</DebugMode>
            <DebuggerType>internal</DebuggerType>
            <DebugHistory>25</DebugHistory>
            <WebGUIMode>off</WebGUIMode>
            <Type>static-backend</Type>
            <XMLManager class="XMLManager">default</XMLManager>
            <StylePolicy class="StylePolicy">TokenProxy_Policy_V1</StylePolicy>
            <MaxMessageSize>0</MaxMessageSize>
            <RequestType>unprocessed</RequestType>
            <ResponseType>json</ResponseType>
            <RequestAttachments>strip</RequestAttachments>
            <ResponseAttachments>strip</ResponseAttachments>
            <RootPartNotFirstAction>process-in-order</RootPartNotFirstAction>
            <FrontAttachmentFormat>dynamic</FrontAttachmentFormat>
            <BackAttachmentFormat>dynamic</BackAttachmentFormat>
            <MIMEHeaders>on</MIMEHeaders>
            <RewriteErrors>on</RewriteErrors>
            <DelayErrors>on</DelayErrors>
            <DelayErrorsDuration>1000</DelayErrorsDuration>
            <SOAPSchemaURL>store:///schemas/soap-envelope.xsd</SOAPSchemaURL>
            <WSDLResponsePolicy>off</WSDLResponsePolicy>
            <FirewallParserLimits>off</FirewallParserLimits>
            <ParserLimitsBytesScanned>4194304</ParserLimitsBytesScanned>
            <ParserLimitsElementDepth>512</ParserLimitsElementDepth>
            <ParserLimitsAttributeCount>128</ParserLimitsAttributeCount>
            <ParserLimitsMaxNodeSize>33554432</ParserLimitsMaxNodeSize>
            <ParserLimitsForbidExternalReferences>on</ParserLimitsForbidExternalReferences>
            <ParserLimitsMaxPrefixes>1024</ParserLimitsMaxPrefixes>
            <ParserLimitsMaxNamespaces>1024</ParserLimitsMaxNamespaces>
            <ParserLimitsMaxLocalNames>60000</ParserLimitsMaxLocalNames>
            <ParserLimitsAttachmentByteCount>2000000000</ParserLimitsAttachmentByteCount>
            <ParserLimitsAttachmentPackageByteCount>0</ParserLimitsAttachmentPackageByteCount>
            <ParserLimitsExternalReferences>forbid</ParserLimitsExternalReferences>
            <CredentialCharset>protocol</CredentialCharset>
            <SSLConfigType>server</SSLConfigType>
            <SSLServer class="SSLServerProfile">Proxy_ServerProfile_V1</SSLServer>
            <SSLClient class="SSLClientProfile">Proxy_ClientProfile_V1</SSLClient>
        </XMLFirewallService>
    </configuration>
</datapower-configuration>
